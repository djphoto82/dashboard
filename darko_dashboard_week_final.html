<!DOCTYPE html>
<html lang="sl">
<head>
  <meta charset="UTF-8">
  <title>Darkov stenski koledar â€“ tedenski (iCal â€“ brez napak)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    /* Tvoj originalni CSS â€“ ostaja enak */
    * { box-sizing: border-box; }
    body { margin: 0; font-family: system-ui, sans-serif; background: #000; color: #f9fafb; overflow: hidden; }
    .bg { position: fixed; inset: 0; background-image: url("https://images.pexels.com/photos/2387873/pexels-photo-2387873.jpeg"); background-size: cover; background-position: center; z-index: -2; }
    .bg-overlay { position: fixed; inset: 0; background: linear-gradient(to bottom, rgba(0,0,0,0.3) 0%, rgba(0,0,0,0.55) 30%, rgba(0,0,0,0.9) 100%); z-index: -1; }
    .layout { height: 100vh; padding: 1.5rem 2rem 1rem 2rem; display: flex; flex-direction: column; justify-content: space-between; }
    .top-row { display: flex; justify-content: space-between; align-items: flex-start; gap: 1.5rem; }
    .clock-wrapper { flex: 1; text-align: center; margin-top: 0.2rem; }
    #clock-time { font-size: 4.5rem; letter-spacing: 0.15em; font-weight: 600; text-shadow: 0 6px 20px rgba(0,0,0,0.7); }
    #clock-date { margin-top: 0.3rem; font-size: 1.1rem; text-shadow: 0 4px 12px rgba(0,0,0,0.7); text-transform: lowercase; }
    .sun-info { margin-top: 0.3rem; font-size: 0.95rem; display: flex; justify-content: center; gap: 1rem; opacity: 0.9; }
    .sun-info span { display: flex; align-items: center; gap: 0.3rem; }
    .weather-card { width: 330px; background: rgba(15,23,42,0.5); border-radius: 18px; padding: 0.8rem; border: 1px solid rgba(148,163,184,0.6); backdrop-filter: blur(10px); box-shadow: 0 12px 30px rgba(0,0,0,0.7); font-size: 0.85rem; }
    /* ... ostali CSS enak kot prej ... */
    .timeline { display: flex; gap: 0.6rem; overflow-x: auto; padding-bottom: 0.4rem; }
    .day-column { min-width: 190px; max-width: 260px; background: rgba(15,23,42,0.85); border-radius: 16px; padding: 0.5rem 0.6rem; border: 1px solid rgba(148,163,184,0.65); box-shadow: 0 10px 30px rgba(0,0,0,0.7); display: flex; flex-direction: column; }
    .day-column.today { border: 2px solid rgba(147,197,253,0.8); box-shadow: 0 0 20px rgba(147,197,253,0.4); }
    /* ... preostanek CSS ... */
  </style>
  <script src="https://unpkg.com/suncalc@1.9.0/suncalc.js"></script>
  <script src="https://unpkg.com/ical.js@1.5.0/build/ical.js"></script>
</head>
<body>
  <div class="bg"></div>
  <div class="bg-overlay"></div>
  <div class="layout">
    <div class="top-row">
      <div style="width:330px;"></div>
      <div class="clock-wrapper">
        <div id="clock-time">--:--:--</div>
        <div id="clock-date">datum...</div>
        <div class="sun-info">
          <span>ðŸŒ… <span id="sunrise">--:--</span></span>
          <span>ðŸŒ‡ <span id="sunset">--:--</span></span>
        </div>
      </div>
      <div class="weather-card">
        <div class="weather-header">
          <span><b>Vreme â€“ Novo mesto</b></span>
          <span class="badge">yr.no</span>
        </div>
        <div class="weather-frame-wrap">
          <iframe class="weather-frame" src="https://www.yr.no/en/content/2-3196350/meteogram.svg" loading="lazy"></iframe>
        </div>
        <div id="hourlyWeather">Nalaganje...</div>
      </div>
    </div>
    <div class="bottom-row">
      <div class="status-bar" id="status">Nalagam koledar...</div>
      <div class="week-nav">
        <button id="prevWeek">â€¹ prejÅ¡nji</button>
        <button id="todayWeek">ta teden</button>
        <button id="nextWeek">naslednji â€º</button>
      </div>
      <div class="timeline"></div>
    </div>
  </div>

  <script>
    // <<< ZAMENJAJ TO Z TVOJI SKRIVNIM iCal LINKOM >>>
    const ICAL_URL = 'https://calendar.google.com/calendar/ical/darkoevapetra%40gmail.com/private-TV0J_K0D_TUKAJ/basic.ics';

    const LAT = 46.1720;
    const LNG = 15.0725;
    let weekOffset = 0;

    function setStatus(msg) { document.getElementById('status').textContent = msg; }

    // Ura, sonce, vreme â€“ enako kot prej
    function updateClock() {
      const now = new Date();
      document.getElementById('clock-time').textContent = now.toLocaleTimeString('sl-SI', {hour:'2-digit', minute:'2-digit', second:'2-digit'});
      document.getElementById('clock-date').textContent = now.toLocaleDateString('sl-SI', {weekday:'long', day:'numeric', month:'long', year:'numeric'});
    }
    function updateSun() {
      const times = SunCalc.getTimes(new Date(), LAT, LNG);
      document.getElementById('sunrise').textContent = times.sunrise.toTimeString().slice(0,5);
      document.getElementById('sunset').textContent = times.sunset.toTimeString().slice(0,5);
    }
    async function loadHourlyWeather() { /* enako kot prej */ }

    // iCal del â€“ glavna sprememba
    async function loadEvents() {
      const weekStart = getWeekStartMonday(new Date(), weekOffset);
      try {
        setStatus('PrenaÅ¡am koledar...');
        const resp = await fetch(`https://corsproxy.io/?${encodeURIComponent(ICAL_URL)}`);
        const text = await resp.text();
        const data = ICAL.parse(text);
        const comp = new ICAL.Component(data);
        const vevents = comp.getAllSubcomponents('vevent');
        const events = vevents.map(v => new ICAL.Event(v)).map(e => ({
          summary: e.summary || '(brez naslova)',
          location: e.location || '',
          start: e.startDate.toJSDate(),
          end: e.endDate.toJSDate(),
          allDay: e.startDate.isDate
        }));
        renderTimeline(weekStart, events.filter(ev => ev.start < new Date(weekStart.getTime() + 7*24*60*60*1000) && ev.end > weekStart));
        setStatus('Koledar naloÅ¾en');
      } catch (e) {
        setStatus('Napaka pri iCal â€“ preveri link');
      }
    }

    // renderTimeline, getWeekStartMonday, navigacija â€“ enako kot prej

    document.addEventListener('DOMContentLoaded', () => {
      updateClock(); setInterval(updateClock, 1000);
      updateSun();
      loadHourlyWeather();
      loadEvents();
      setInterval(loadEvents, 600000); // osveÅ¾i vsakih 10 min
      // navigacijske tipke
    });
  </script>
</body>
</html>
